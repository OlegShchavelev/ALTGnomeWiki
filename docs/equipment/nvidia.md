# NVIDIA

Эта статья описывает процесс установки и настройки драйверов для видеочипов NVIDIA.

На данный момент существуют 2 драйвера:

### 1. Проприетарный драйвер от NVIDIA

NVIDIA — это собственный драйвер от [NVIDIA](https://www.nvidia.com). Этот драйвер является [закрытым программным обеспечением](https://en.wikipedia.org/wiki/Proprietary_software) и поставляется отдельно от ядра GNU/Linux, требуя индивидуальной установки.

Важно отметить, что драйвер NVIDIA постоянно развивается и обновляется, и различные версии могут иметь особенности и ограничения, [поэтому критически важно знать версию установленного драйвера и информацию, связанную с ним.](#настроика-драивера)

При установке основного пакета [`nvidia_glx_common`](#способ-2-вручную), необходимая версия драйвера устанавливается автоматически, не требуя никаких дополнительных действий со стороны пользователя. Также существует скрипт установки через [EPM](#способ-1-через-epm), предлагающий собственные дополнительные настройки.

### 2. Драйвер Nouveau

Nouveau — это проект с [открытым исходным кодом](https://en.wikipedia.org/wiki/Open-source_software), созданный независимыми разработчиками с использованием методов реверс-инжиниринга. В настоящее время он разрабатывается под эгидой [X.Org Foundation](https://x.org/) и размещается на [freedesktop.org](https://nouveau.freedesktop.org/). Nouveau является частью проекта [Mesa 3D](https://www.mesa3d.org/) и систем на базе GNU/Linux.

Из-за обратно-проектируемого метода разработки уровень поддержки различных архитектур GPU может варьироваться, поэтому важно знать, [насколько хорошо](https://nouveau.freedesktop.org/FeatureMatrix.html) Nouveau поддерживает целевую видеокарту.

Драйвер Nouveau изначально присутствует в ядре системы и требует вмешательства в редких случаях, таких как [использование на Macbook](https://alt-gnome.wiki/macbook-with-nouveau.html).

::: info
Названия видеокарт, кодовые наименования и архитектуру можно посмотреть на отдельной странице [Code Names](https://nouveau.freedesktop.org/CodeNames.html)
:::

## Выбор правильного драйвера

При выборе драйвера для графического чипа следует учесть три основных аспекта:

1. **Развитие драйверов:** Как Nouveau, так и драйвер от NVIDIA постоянно обновляются и развиваются. Невозможно точно предсказать, какие функции будут добавлены или изменены в будущем. Если однажды услышали, что чего-то нет в каких-то драйверах, через полгода это может поменяться.
2. **Архитектура графического чипа:** Важно учитывать, что старые модели графических чипов, как правило, лучше работают с драйвером Nouveau, чем с последними, где предпочтительнее использовать драйвер NVIDIA. Однако всё индивидуально, и проверка требуется для каждой архитектуры видеочипов отдельно. Для проверки уровня поддержки различных архитектур можно обратиться к [Feature Matrix](https://nouveau.freedesktop.org/FeatureMatrix.html) для Nouveau и к [блоку настройки драйвера](#настройка-драйвера) в случае с NVIDIA.
3. **Происхождение драйверов:** Проприетарный драйвер NVIDIA разрабатываются самой компанией NVIDIA и зачастую не контактирует с сообществом Linux. В то же время Nouveau является частью проекта Mesa (одной из основных частей графического стека GNU/Linux). Однако он разрабатывается с помощью реверс-инжиниринга, то есть проприетарный драйвер обычно обеспечивает более высокий уровень поддержки видеокарт, в то время как Nouveau обеспечивает более глубокую интеграцию с GNU/Linux системами.

### Отличия в драйверах

Проприетарный драйвер NVIDIA обеспечивает управление питанием большего числа видеокарт, поддерживает работу CUDA, а также лучше справляется с поддержкой игр и графических программ.

Открытый Nouveau встроен в ядро GNU/Linux и обычно не требует дополнительных настроек, также обеспечивает управление питанием, но на меньшем количестве видеокарт, не поддерживает CUDA и имеют плохую поддержку игр. [В некоторых моментах](https://gitlab.freedesktop.org/xorg/xserver/-/issues/1317) справляется лучше, чем NVIDIA.

::: info
Дополнительную информацию о поддержке управления питанием с использованием Nouveau можно найти на странице [PowerManagement](https://nouveau.freedesktop.org/PowerManagement.html)
:::

### Рекомендации по выбору

Если драйвер выбирается для игр, CUDA и других технологий NVIDIA, а при использовании Nouveau возникают проблемы с производительностью, — рекомендуется установить драйвер NVIDIA.

Если вышеупомянутые технологии не используете и видеокарта работает стабильно на Nouveau — рекомендуется выбирать его.

## Проприетарный драйвер NVIDIA

### Установка (Смена Nouveau драйвера на проприетарный)

#### Способ 1. EPM Play

::: tip
Если необходима наиболее простая установка, используйте этот способ.
:::

Для упрощения процесса установки проприетарного драйвера для графических карт NVIDIA, можно использовать скрипт из [EPM](/epm).

Данный скрипт включает в себя **наиболее полную первоначальную настройку**, затрагивая активацию Wayland и решение проблемы с [неизвестным монитором](#«неизвестныи-монитор»-в-настроиках-дисплеев-в-сессии-wayland), **но только для нового драйвера**.

Выполните следующую команду в терминале:

```shell
su -
epm play switch-to-nvidia
```

::: warning
Для корректной установки во время выполнения скрипта следует внимательно читать появляющиеся сообщения и в точности следовать инструкциям. Возможно потребуется несколько перезагрузок, например, для автоматического обновления ядра.
:::

После успешного завершения работы скрипта нужно перезагрузить операционную систему.

#### Способ 2. Установка из RUN-файла

::: danger Дисклеймер
Все действия, описанные в данной статье, вы выполняете на свой страх и риск.
Автор статьи и сообщество ALT Linux Team, а также ООО «Базальт СПО» не несут ответственность за возможные последствия.

Выполняйте все действия по собственной инициативе, возникающие проблемы решайте самостоятельно или обращаясь за помощью к сообществу.

ВСЁ ОПИСАННОЕ ДАЛЕЕ ВЫПОЛНЯЛОСЬ НА ЧИСТОЙ СИСТЕМЕ,
В ОДНОНАПРАВЛЕННОМ ПОРЯДКЕ, ОТКАТ СИСТЕМЫ НЕ ПРОВЕРЯЛСЯ !!!

ВЫ ОБЯЗУЕТЕСЬ ПРОЧИТАТЬ ДОКУМЕНТ ДО КОНЦА
БЕЗДУМНОЕ КОПИРОВАНИЕ НЕ ОСВОБОЖДАЕТ ВАС ОТ ПРОБЛЕМ
И ЕЩЕ РАЗ ЗАНОВО ПРОЧИТАТЬ ПРЕЖДЕ ЧЕМ ДЕЛАТЬ
ЕСЛИ СОМНЕНИЯ НЕ ИСЧЕЗЛИ ТО НЕ НАДО ДЕЛАТЬ ЭТОГО !!!

ИНСТРУКЦИЯ НЕ ПОДХОДИТ ДЛЯ ДРАЙВЕРОВ НИЖЕ 560 ТАК КАК ТЕСТИРОВАЛАСЬ ТОЛЬКО НА ЭТО И ВЕРСИИ СТАРШЕ
:::

::: details В примере использовалась следующая конфигурация

- Персональный компьютер архитектуры x86_64;
- Система ALT Regular Gnome (current);
- Видеокарта NVIDIA 4080 Super;
- Отключённый Secure Boot;
- Выключенное встроенное в процессор видеоядро.

В примере использовался драйвер [560.35.03](https://ru.download.nvidia.com/XFree86/Linux-x86_64/560.35.03/NVIDIA-Linux-x86_64-560.35.03.run)
(дата релиза — 21 августа 2024)
На текущий момент драйвер может быть свежее

:::

###### Подготовка

Загрузка драйвера с сайта NVIDIA:

1. [На сайте NVIDIA](https://www.nvidia.com/ru-ru/geforce/drivers/) НАЙДИТЕ последний подходящий драйвер, выбрав модель карты и операционную систему Linux 64-bit (драйверы Linux Aarch64 ставится аналогично), и скачайте этот драйвер;

2. Под пользователем `root` переместите скачанный файл в папку `/opt`;

3. ОБЯЗАТЕЛЬНО обновите систему:

```sh
su -
apt-get update
apt-get dist-upgrade
update-kernel # установит последнее ядро
```

После обновления понадобится перезагрузка для активации установленного ядра.

4. Установите дополнительные зависимости:

```sh
su -
apt-get install gcc kernel-headers-modules-$kflavor dkms libglvnd-devel # где $kflavor - версия флейвора вашего запущенного ядра
reboot
```

::: alert

Нужно перезагрузиться ещё раз, чтобы DKMS начал работать.

:::

5. Переход в TTY:

Нажмите сочетание клавиш [[Ctrl + Alt + F3]] (или другие сочетания). Будет осуществлён переход в TTY (чёрный экран и строка ожидания ввода логина)

Войдите под суперпользователем `root` и отключите дисплейный менеджер (в случае с ALT Regular Gnome — GDM):

```sh
systemctl stop gdm
```

6. Установка драйвера (на примере версии 560.35.03):

```sh
cd /opt
chmod +x NVIDIA-Linux-x86_64-560.35.03.run
./NVIDIA-Linux-x86_64-560.35.03.run
```

После выбора `Proprietary` (да да да проверял только тут, есть еще MIT/GPL но там не тестировал) начнётся установка, в ходе которой установщик может попросить отключить Nouveau — подтвердите это действие. Установщик может предложить провести проверку установки — нажмите `Continue without check`. Подтвердите установку библиотек `i586`, ОТКАЖИТЕСЬ от добавления настроек в X-Config если вам нужен WAYLAND. В конце подтвердите добавление драйвера в `DKMS`.

7. Последняя настройка до перезагрузки машины:

- В файле `/etc/sysconfig/grub2` добавьте в параметр `GRUB_CMDLINE_LINUX_DEFAULT` строчку `nvidia-drm.modeset=1` и пересоздайте файл настройки загрузчика GRUB2, выполнив:

```shell
grub-mkconfig -o /boot/grub/grub.cfg
```

- Создайте файл `/etc/modprobe.d/nvidia.conf` с следующим содержимым:

```text
blacklist nouveau
options nvidia_drm fbdev=1
options nvidia NVreg_PreserveVideoMemoryAllocations=1
options nvidia NVreg_TemporaryFilePath=/var/tmp
```

Если установщик предложил вам отключить запуск Nouveau, вместо создания отдельного файла достаточно отредактировать созданный драйвером файл. Он будет находиться в `/etc/modprobe.d/` и называться `nvidia-installer-*`. Добавьте в него следующие строки:

```text
options nvidia_drm fbdev=1
options nvidia NVreg_PreserveVideoMemoryAllocations=1
options nvidia NVreg_TemporaryFilePath=/var/tmp
```

8. Пересоберите initrd с помощью команды:

```shell
make-initrd -k $(uname -r)
```

9. Удаление установщика:

```sh
cd /opt
rm NVIDIA-Linux-x86_64-560.35.03.run
```

#### Способ 3. Вручную

Для перехода с Nouveau на NVIDIA рекомендуется сначала обновить ядро:

```shell
su -
update-kernel
```

Для дальнейшей установки проприетарного драйвера NVIDIA **необходимо перезагрузить операционную систему**.

#### Установка проприетарного драйвера и добавление Nouveau в чёрный список:

- Перейдите в режим root:

```shell
su -
```

- Установите `nvidia_glx_common`:

::: code-group

```shell[apt-get]
apt-get install nvidia_glx_common
```

```shell[epm]
epm -i nvidia_glx_common
```

:::

- Добавьте Nouveau в чёрный список:

```shell
echo "blacklist nouveau" > /etc/modprobe.d/blacklist-nvidia-x11.conf
```

- Запустите скрипт установки драйверов:

```shell
nvidia-install-driver
```

### Настройка драйвера

Существует 4 версии драйвера NVIDIA, устанавливающиеся в зависимости от поколения видеокарты.

Далее будет описана важная информация и настройка каждой из этих версий.

::: tip

Чтобы узнать версию установленного драйвера, необходимо ввести:

```shell
inxi -G
```

:::

#### Драйвер 550.54.14 или новее

При установке драйвера через [EPM](#способ-1-через-epm) настройка под Wayland производится автоматически. Если использован этот способ, дальнейшая настройка под Wayland не требуется.

Если установка производилась вручную, следует выполнить дальнейшую настройку.

##### Сессия Wayland

Для работы Wayland необходимо настроить [сохранение выделенных ресурсов видеопамяти](#настроика-сохранения-выделенных-ресурсов-видеопамяти)

::: warning
У драйвера NVIDIA существуют [известные проблемы и несовместимости](#проблемы-c-протоколом-wayland), связанные с Wayland.
:::

##### Работа заставки (plymouth)

Для работы заставки необходимо запустить модули драйвера как можно раньше, для этого необходимо [положить их в `initramfs`](#ранняя-загрузка-модулеи-nvidia)

Также, если в параметрах ядра есть `initcall_blacklist=simpledrm_platform_driver_init`, его необходимо удалить и использовать другой способ из [решения проблем с «Неизвестным монитором»](#«неизвестныи-монитор»-в-настроиках-дисплеев-в-сессии-wayland)

::: tip
Проверить, есть ли этот параметр, можно в файле `/etc/sysconfig/grub2` в строке с параметром `GRUB_CMDLINE_LINUX_DEFAULT`.
:::

::: danger При установке через EPM и для пользователей **Ximper**
Этот параметр будет у Вас будет по умолчанию.
:::

#### Драйвер 470.223.02

::: info

Драйвер до версии 495 имеет поддержку только одного Buffer API — [EGLStreams](https://www.phoronix.com/news/GNOME-Mutter-Mainline-EGLStream).

Он не был популяре и критиковался, но безальтернативная связка с NVIDIA «заставляла» некоторые крупные проекты работать с ним.

Начиная с версии 495, NVIDIA представила поддержку [Generic Buffer Management (GBM)](https://en.wikipedia.org/wiki/Generic_Buffer_Management), и подавляющее большинство проектов отказалось от EGLStreams.

GNOME один из немногих, кто ещё поддерживает EGLStreams, однако сейчас его поддержка постепенно уходит на второй план.

:::

##### Проблема с Intel

Драйвер версии 470.223.02 и старше, начиная с версии ядра Linux 5.18 может работать неправильно в системах с процессорами Intel 11-го поколения и новее из-за несовместимости с [Indirect Branch Tracking (IBT)](https://edc.intel.com/content/www/us/en/design/ipla/software-development-platforms/client/platforms/alder-lake-desktop/12th-generation-intel-core-processors-datasheet-volume-1-of-2/007/indirect-branch-tracking/).

Его можно отключить, добавив значение `ibt=off` в параметр `GRUB_CMDLINE_LINUX_DEFAULT`:

```shell
su -
mcedit /etc/sysconfig/grub2
grub-mkconfig -o /boot/grub/grub.cfg
```

::: warning
Эта функция безопасности отвечает за [защиту от ряда методов эксплойта](https://lwn.net/Articles/889475/).
:::

##### Сессия Wayland

Для работы Wayland необходимо сделать 2 вещи:

1. Активировать метод [Kernel Mode Setting](#активация-kernel-mode-setting)
2. Настроить [сохранение выделенных ресурсов видеопамяти](#настроика-сохранения-выделенных-ресурсов-видеопамяти)

::: warning
У драйвера NVIDIA существуют [известные проблемы и несовместимости](#проблемы-c-протоколом-wayland), связанные с Wayland.
:::

##### Работа заставки (plymouth)

Для работы заставки необходимо запустить модули драйвера как можно раньше, для этого необходимо [положить их в `initramfs`](#ранняя-загрузка-модулеи-nvidia)

Также, если у вас в параметрах ядра есть `initcall_blacklist=simpledrm_platform_driver_init`, его необходимо удалить и использовать другой способ из [решения проблем с «Неизвестным монитором»](#«неизвестныи-монитор»-в-настроиках-дисплеев-в-сессии-wayland)

::: tip
Проверить, есть ли этот параметр можно в файле `/etc/sysconfig/grub2` в строке с параметром `GRUB_CMDLINE_LINUX_DEFAULT`.
:::

::: danger При установке через EPM и для пользователей **Ximper**
Этот параметр будет у Вас будет по умолчанию.
:::

#### Драйвер 390.157

::: info

Драйвер до версии 495 имеет поддержку только одного buffer API — [EGLStreams](https://www.phoronix.com/news/GNOME-Mutter-Mainline-EGLStream).

Он часто предавался критике и не взыскал популярности, но безальтернативная связка с NVIDIA "заставляла" некоторые крупные проекты работать с ним.

Начиная с 495, NVIDIA представила поддержку [GBM](https://en.wikipedia.org/wiki/Generic_Buffer_Management), и с тех пор подавляющее большинство проектов отказалось от EGLStreams.

GNOME, один из немногих, кто ещё поддерживает EGLStreams, но на сегодняшний день эта поддержка постепенно уходит на второй план.

Драйверы NVIDIA до версии 470 не поддерживают аппаратное ускорение Xwayland.

Для драйвера до версии ~400 ускоренное декодирование видео NVDEC **недоступен**.

:::

##### Сессия Wayland

Для работы Wayland необходимо 2 вещи:

1. Активировать метод [Kernel Mode Setting](#активация-kernel-mode-setting)
2. Настроить [сохранение выделенных ресурсов видеопамяти](#настроика-сохранения-выделенных-ресурсов-видеопамяти)

::: warning
У драйвера NVIDIA существуют [известные проблемы и несовместимости](#проблемы-c-протоколом-wayland), связанные с Wayland.
:::

##### Работа заставки (plymouth)

Для работы заставки необходимо запустить модули драйвера как можно раньше, для этого необходимо [положить их в `initramfs`](#ранняя-загрузка-модулеи-nvidia)

Также, если у вас в параметрах ядра есть `initcall_blacklist=simpledrm_platform_driver_init`, его необходимо удалить и использовать другой способ из [решения проблем с «Неизвестным монитором»](#«неизвестныи-монитор»-в-настроиках-дисплеев-в-сессии-wayland)

::: tip
Проверить, есть ли этот параметр можно в файле `/etc/sysconfig/grub2` в строке с параметром `GRUB_CMDLINE_LINUX_DEFAULT`.
:::

::: danger При установке через EPM и для пользователей **Ximper**
Этот параметр будет у Вас будет по умолчанию.
:::

### Полезные программы

::: info

При установке драйвера через **EPM**, многие программы, скорее всего, уже будут установлены.

Группа устанавливаемых пакетов, может постоянно меняться, поэтому для уточнения следует посмотреть [EPM-скрипт](https://gitlab.eterfund.ru/etersoft/eepm/blob/master/prescription.d/switch-to-nvidia.sh)

:::

#### NVIDIA Settings

NVIDIA Settings — утилита для настройки и оптимизации графических параметров на компьютерах с видеокартами NVIDIA. Она позволяет пользователям настраивать качество изображения, разрешение экрана, а также различные параметры, связанные с производительностью видеокарты. С помощью NVIDIA Settings можно также включить или отключить определённые функции, такие как вертикальная синхронизация или сглаживание.

В зависимости от сессии (Xorg или Wayland) набор настроек в NVIDIA Settings может различаться. Например, в Wayland нельзя настроить вертикальную синхронизацию и тройную буферизацию, так как они работа по-другому в этом окружении. Также в Wayland нет поддержки G-Sync, так как эта технология работает только с NVIDIA и требует специального оборудования. В целом, основные функции NVIDIA Settings доступны в обоих окружениях, но некоторые дополнительные возможности могут быть ограничены.

::: code-group

```shell[apt-get]
su -
apt-get update
apt-get install nvidia-settings
```

```shell[epm]
epm -i nvidia-settings
```

:::

#### NVIDIA System Management Interface

NVIDIA System Management Interface (NVSMI), или [nvidia-smi](https://developer.download.nvidia.com/compute/DCGM/docs/nvidia-smi-367.38.pdf) — предоставляет возможности мониторинга и управления для NVIDIA Tesla, Quadro, GRID и GeForce, начиная с семейства Fermi.

::: code-group

```shell[apt-get]
su -
apt-get update
apt-get install nvidia-smi
```

```shell[epm]
epm -i nvidia-smi
```

:::

#### switcheroo-control

switcheroo-control — утилита для выбора графического устройства при запуске приложения на устройствах с несколькими графическими процессорами

::: info
Для устройств, имеющих как встроенный, так и выделенный графический процессор, switcheroo-control по умолчанию использует встроенный графический процессор для экономии энергии.
:::

::: code-group

```shell[apt-get]
su -
apt-get update
apt-get install switcheroo-control
systemctl enable --now switcheroo-control.service
```

```shell[epm]
epm -i switcheroo-control
systemctl enable --now switcheroo-control.service
```

:::

После установки приложения switcheroo-control, в меню появится пункт «Запустить с помощью выделенной видеокарты»

![Запустить с помощью выделенной видеокарты](/nvidia/switcheroo-control-1.jpg)

#### EnvyControl

EnvyControl — CLI-утилита, которая позволяет выбирать режим работы гибридной графики:

1. **Гибридный режим**

   - Позволяет драйверу самому решать, какой графический процессор использовать. Обычно используется интегрированная графика, а дискретная графика работает только если она нужна, например, в играх или программах для монтажа
   - Позволяет использовать [RTD3](#управление-питанием-pci-express-runtime-d3-rtd3)
   - Работает только на видеокартах Turing и выше
   - Возможны проблемы с HDMI

2. **Интегрированный режим**

   - Использует только интегрированную графику (Intel или AMD) отключая NVIDIA
   - Мониторы подключённые к NVIDIA работать не будут

3. **Режим NVIDIA**

   - Используется исключительно видеокарта от NVIDIA

##### Примеры

Установить интегрированный режим:

```shell
su -
envycontrol -s integrated
```

Установить гибридный режим и включить RTD3 (если не указывать режим, то будет выбран второй):

```shell
su -
envycontrol -s hybrid --rtd3
```

Установить гибридный режим, включить `ForceCompositionPipeline`, а так же установить `coolbits` на 28, разрешая разгон видеокарты:

```shell
su -
envycontrol -s nvidia --force-comp --coolbits 28
```

::: code-group

```shell[apt-get]
su -
apt-get update
apt-get install envycontrol
```

```shell[epm]
epm -i envycontrol
```

:::

После установки рекомендуется ввести команду `envycontrol --help`, чтобы ознакомиться со всеми возможностями утилиты. Также доступно [расширение для GNOME](https://extensions.gnome.org/extension/5009/gpu-profile-selector/)

#### Vulkan Information

Vulkan Information — отображает информацию о поддерживаемых возможностях Vulkan для пользователей графических устройств NVIDIA. Необходимо установить пакет `vulkan-tools`:

::: code-group

```shell[apt-get]
su -
apt-get update
apt-get install vulkan-tools
```

```shell[epm]
epm -i vulkan-tools
```

:::

Для вывода общей информации в терминале:

```shell
vulkaninfo --summary
```

#### nvidia-vaapi-driver

nvidia-vaapi-driver — реализация VA-API, использующая NVDEC в качестве бэкенда. Эта реализация специально разработана для использования в Firefox для ускоренного декодирования веб-содержимого и может работать некорректно в других приложениях. Дополнительную информацию можно посмотреть на [странице проекта](https://github.com/elFarto/nvidia-vaapi-driver)

::: code-group

```shell[apt-get]
su -
apt-get update
apt-get install nvidia-vaapi-driver
```

```shell[epm]
epm -i nvidia-vaapi-driver
```

:::

#### nvidia-modprobe

nvidia-modprobe — используется компонентами драйвера NVIDIA в пользовательском пространстве для проверки загрузки модуля ядра NVIDIA и наличия файлов устройств NVIDIA. Эти возможности обычно предоставлялись системами конфигурации дистрибутива GNU/Linux, такими как `udev`.

::: tip
По возможности рекомендуется использовать встроенные механизмы вашего дистрибутива GNU/Linux для управления загрузкой модулей ядра и созданием файлов устройств. Эта утилита предоставляется в качестве запасного варианта для работы независимо от дистрибутива.
:::

::: code-group

```shell[apt-get]
su -
apt-get update
apt-get install nvidia-modprobe
```

```shell[epm]
epm -i nvidia-modprobe
```

:::

#### nvidia-cuda-toolkit

nvidia-cuda-toolkit — пакет, содержащий библиотеки и сопутствующие файлы, необходимые для запуска
программ, использующих [CUDA](https://developer.nvidia.com/cuda-toolkit).

::: code-group

```shell[apt-get]
su -
apt-get update
apt-get install nvidia-cuda-toolkit
```

```shell[epm]
epm -i nvidia-cuda-toolkit
```

:::

#### nvidia-xconfig

nvidia-xconfig — инструмент, предназначенный для обеспечения базового управления по параметрам конфигурации, доступным в драйвере NVIDIA X11.

::: code-group

```shell[apt-get]
su -
apt-get update
apt-get install nvidia-xconfig
```

```shell[epm]
epm -i nvidia-xconfig
```

:::

### Выбор проприетарного драйвера в Центр управления системой (только для X11)

::: danger

Выбор драйвера через Центр управления системой (ЦУС) происходит путём изменения `/etc/X11/xorg.conf.d/10-monitor.conf` и работает только на **Xorg** сессии, только на поздних этапах, игнорируя **KMS**.

На данный момент, такой способ изменения драйвера не будет работать с **Wayland**, является устаревшим и [**не рекомендуется**](https://www.altlinux.org/index.php?title=NVIDIA&diff=75067&oldid=73752)

Данная инструкция рекомендована для использования только на стационарных ПК, в которых графическая карта NVIDIA будет использована как основная. Для ноутбуков с гибридной графикой рекомендуется пропустить этот шаг и воспользоваться [switcheroo-control](#switcheroo-control) или [envycontrol](#envycontrol)

:::

::: info

Удостоверьтесь, что пакет `alterator-x11` и драйвер от NVIDIA установлены.

Без этого, вариант `nvidia - NVIDIA (proprietary)` в разделе выбора драйвера будет недоступен

:::

::: details Выбор проприетарного драйвера

- Зайдите в Центр управления системой

![nvidia-acc-1](/nvidia/nvidia-acc-1.png)

- Выберите параметр `Дисплей` в категории `Графический интерфейс`

![nvidia-acc-2](/nvidia/nvidia-acc-2.png)

- В графе `Драйвер` нажмите `Другой драйвер`.

![nvidia-acc-3](/nvidia/nvidia-acc-3.png)

- В открывшемся окне выберите `nvidia - NVIDIA (proprietary)`

- После выбора нажмите `ОК`, `Применить` и перезагрузите систему

:::

### Детальная настройка драйвера

#### Активация [Kernel Mode Setting](https://www.kernel.org/doc/html/latest/gpu/drm-kms.html).

Необходимо прописать в параметр `GRUB_CMDLINE_LINUX_DEFAULT` значение `nvidia-drm.modeset=1` и сгенерировать новых `grub.cfg`:

```shell
su -
mcedit /etc/sysconfig/grub2
grub-mkconfig -o /boot/grub/grub.cfg
```

::: tip

Чтобы проверить, работает ли KMS, выполните:

```shell
su -
cat /sys/module/nvidia_drm/parameters/modeset
```

Если команда вернула `Y`, то KMS работает. В ином случае можете попробовать включить его через [параметры ядра](#не-работает-kms)

:::

::: details В драйверах 550.54.14 и выше настройка KMS не нужна
[Начиная с октября 2023 года](https://git.altlinux.org/tasks/archive/done/_324/332535/gears/100/git?p=git;a=commit;h=3bb30586e8c78e167a59f680370bad04fe50fadc), в ручной активации KMS нет необходимости. Правильная опция будет прописана вместе с установкой драйвера и будет находиться в `/etc/modprobe.d/nvidia_common.conf`.
:::

#### Настройка сохранения выделенных ресурсов видеопамяти

[NVIDIA предлагает 2 способа](https://download.nvidia.com/XFree86/Linux-x86_64/550.40.07/README/powermanagement.html):

##### Способ 1. Сохранение в безымянных временных файлах

Такой способ позволяет использовать глубокий уровень сна (`S4` и `S5`) и не требует дополнительной поддержки `S0ix`.

::: warning
Существуют проблемы на некоторых устройствах с PRIME. Этот способ направлен в основном на **настольные ПК**
:::

- Активируйте интерфейсы управления питания NVIDIA:

```shell
su -
systemctl enable nvidia-suspend.service nvidia-resume.service nvidia-hibernate.service
```

::: tip
Эти интерфейсы заменяют стандартные `sleep`, `hibernate` и `resume`, давая возможность записать ресурсы видеопамяти перед отключением питания у видеокарты.
:::

::: info
Если вы устанавливали проприетарный драйвер NVIDIA при помощи [epm](/epm), то данная команда уже была выполнена автоматически.
:::

- В опциях драйвера NVIDIA измените способ сохранения ресурсов видеопамяти:

```shell
su -
cat << _EOF_ > /etc/modprobe.d/nvidia_videomemory_allocation.conf
options nvidia NVreg_PreserveVideoMemoryAllocations=1
options nvidia NVreg_TemporaryFilePath=/var/tmp
_EOF_
make-initrd
```

::: info

Для сохранения ресурсов видеопамяти важно, чтобы файловая система имела поддержку безымянных временных файлов и имела достаточный объём для сохранения видеопамяти. Объёма, равного сумме всей видеопамяти и 5% сверху, будет вполне достаточно для сохранения.

Узнать количество видеопамяти можно командой:

```shell
nvidia-smi -q -d MEMORY | grep 'FB Memory Usage' -A1
```

Также во избежание нехватки места, не следует указывать директории с `tmpfs` (например, `/tmp` или `/run`) в опции `NVreg_TemporaryFilePath`.

NVIDIA не даёт каких-то конкретных рекомендаций, какую директорию использовать, но на форумах зачастую рекомендуется `/var/tmp`, что соответствует [описанию раздела](https://www.pathname.com/fhs/pub/fhs-2.3.html#VARTMPTEMPORARYFILESPRESERVEDBETWEE).

:::

##### Способ 2. Режим сохранения питания [`S0ix`](https://ru.msi.com/blog/why-modern-standby-matters-for-business-laptop#:~:text=%D0%A4%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F%20Modern%20Standby%20%E2%80%93%20%D1%8D%D1%82%D0%BE,%D0%BE%D0%BD%D0%B0%20%D0%BF%D0%BE%D0%B7%D0%B2%D0%BE%D0%BB%D1%8F%D0%B5%D1%82%20%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D1%83%20%C2%AB%D0%BF%D1%80%D0%BE%D0%B1%D1%83%D0%B6%D0%B4%D0%B0%D1%82%D1%8C%D1%81%D1%8F%C2%BB%20%D0%BC%D0%BE%D0%BC%D0%B5%D0%BD%D1%82%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE).

Этот способ позволяет не выгружать видеопамять. Режим `S0ix` создан **для переносных устройств**.

- Проверьте, поддерживает ли система `s2idle`:

```shell
cat /sys/power/mem_sleep
```

::: tip
Если в выводе есть `s2idle`, значит он поддерживается. В ином случае используйте [Способ 1](#способ-1-сохранение-в-безымянных-временных-фаилах).
:::

- Проверьте, поддерживает ли видеочип `S0ix`:

```shell
grep 'Video Memory Self Refresh' /proc/driver/nvidia/gpus/<Domain>:<Bus>:<Device>.0/power
```

::: info
Посмотрите в директории после `/proc/driver/nvidia/gpus`, у каждого устройства своё значение `<Domain>`, `<Bus>` и `<Device>`
:::

::: tip
Если ответ `Video Memory Self Refresh: is supported`, значит `S0ix` поддерживается и можно проверять систему дальше.
:::

- Если система и видеочип поддерживают указанные режимы, добавьте параметр `NVreg_EnableS0ixPowerManagement=1`:

```shell
su -
modprobe nvidia NVreg_EnableS0ixPowerManagement=1
```

- Если при выводе `cat /sys/power/mem_sleep`, `s2idle` не был в квадратных скобках (`[s2idle]`), выполните:

```shell
su -
echo "s2idle" > /sys/power/mem_sleep
```

- После указания опции и режима переведите устройство в режим ожидания и проверьте, корректно ли всё загрузилось. Если всё хорошо, добавьте настройки для постоянной загрузки:

```shell
su -
cat << _EOF_ > /etc/modprobe.d/enable_S0ix_power_management.conf
options nvidia NVreg_EnableS0ixPowerManagement=1
_EOF_
make-initrd
```

- Если ранее приходилось указывать `s2idle` вручную, укажите в параметре `GRUB_CMDLINE_LINUX_DEFAULT` значение `mem_sleep_default=s2idle` и сгенерируйте новых `grub.cfg`:

```shell
su -
mcedit /etc/sysconfig/grub2
grub-mkconfig -o /boot/grub/grub.cfg
```

::: info

При переходе видеокарты в спящий режим `S0ix` будет выполнятся один из 2-х сценариев:

- Если использование памяти было меньше определённого порога, видеопамять будет скопирована в системную память и полностью отключится вместе с графическим процессором
- Если использование памяти было больше определённого порога, видеопамять будет в режиме самообновления, в то время как остальная часть графического процессора будет отключена

По умолчанию порог — 256 МБ. Его можно изменить с помощью параметра `NVreg_S0ixPowerManagementVideoMemoryThreshold`. Однако стоит учитывать, что чем выше порог, тем выше вероятность того, что часть видеопамяти не будет сохранена.

:::

#### Ранняя загрузка модулей NVIDIA

Для того, чтобы запустить модули NVIDIA на этапе `initramfs`, необходимо добавить их в `/etc/initrd.mk` и отключить [Features](https://github.com/osboot/make-initrd/wiki/Features), которые [запрещают их загрузку](https://git.altlinux.org/gears/n/nvidia_glx_common.git?p=nvidia_glx_common.git;a=blob;f=nvidia_glx_common.spec;h=9cb3c8612ca3fe49cca54876ab243b8cec0a61ca;hb=5177d158e5df98dc3dd4e9ded0f690a7ddfb5ad1#l276).

- Добавьте в `/etc/initrd.mk` строки `MODULES_TRY_ADD +=nvidia nvidia-drm nvidia-modeset nvidia-uvm` и `DISABLE_FEATURES += nvidia` и сгенерируйте `initramfs`:

```shell
su -
cat << _EOF_ >> /etc/initrd.mk

# trying to load nvidia modules
MODULES_TRY_ADD += nvidia nvidia-drm nvidia-modeset nvidia-uvm
DISABLE_FEATURES += nvidia
_EOF_
make-initrd
```

::: warning
При добавлении модулей в `initramfs` не будет работать способ [Замены драйверов Nouveau / NVIDIA «на лету»](https://www.altlinux.org/NVIDIA#%D0%97%D0%B0%D0%BC%D0%B5%D0%BD%D0%B0_%D0%B4%D1%80%D0%B0%D0%B9%D0%B2%D0%B5%D1%80%D0%BE%D0%B2_nouveau/nvidia_%22%D0%BD%D0%B0_%D0%BB%D0%B5%D1%82%D1%83%22)
:::

#### Управление питанием PCI-Express Runtime D3 (RTD3)

Драйвер NVIDIA имеет поддержку динамического управления питанием графического процессора NVIDIA — [PCI-Express Runtime D3 (RTD3) Power Management](https://download.nvidia.com/XFree86/Linux-x86_64/550.40.07/README/dynamicpowermanagement.html).

В это управление входит регулирование тактовой частоты и напряжения на разных участках микросхемы, а также, в некоторых случаях, полное отключение тактовой частоты или питания элементов чипа.

И всё это не влияя на функциональность позволит работать графическому процессору с меньшей производительностью при меньшем потреблением энергии.

Для работы RTD3 необходимо следующее:

- Ноутбук
- Процессор из серия чипсетов Coffee Lake или новее
- Видеокарта архитектуры Turing или новее
- Ядро Linux версии 4.18 и новее, собранное с `CONFIG_PM` (`CONFIG_PM=y`). Как правило, если система поддерживает `S3` (`suspend-to-RAM`), то и `CONFIG_PM` будет корректно определён

::: info

Для видеокарт Turing и старше нужна дальнейшая настройка

Для Ampere или более поздних версий видеокарт, **RTD3 включено по умолчанию.**

:::

- Для автоматизации управления добавьте правила в `/lib/udev/rules.d`:

```shell
su -
cat << _EOF_ > /lib/udev/rules.d/80-nvidia-pm

# Enable runtime PM for NVIDIA VGA/3D controller devices on driver bind
ACTION=="bind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030000", TEST=="power/control", ATTR{power/control}="auto"
ACTION=="bind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030200", TEST=="power/control", ATTR{power/control}="auto"

# Disable runtime PM for NVIDIA VGA/3D controller devices on driver unbind
ACTION=="unbind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030000", TEST=="power/control", ATTR{power/control}="on"
ACTION=="unbind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030200", TEST=="power/control", ATTR{power/control}="on"
_EOF_
make-initrd
```

- Добавьте конфигурационный файл с параметром в `/etc/modprobe.d`:

```shell
su -
cat << _EOF_ > /etc/modprobe.d/nvidia_RTD3.conf
# This options activate RTD3
options nvidia "NVreg_DynamicPowerManagement=0x02"
_EOF_
make-initrd
```

::: info
Более подробное описание работы, а также решение возможных проблем можно посмотреть в [документации NVIDIA](https://download.nvidia.com/XFree86/Linux-x86_64/550.40.07/README/dynamicpowermanagement.html).
:::

#### PAT

[PAT](https://docs.kernel.org/arch/x86/pat.html) — более современная технология, чем [MTRR](https://docs.kernel.org/arch/x86/mtrr.html), является более гибким атрибутом, добавляя новые возможности для организации памяти.

Драйвер NVIDIA позволяет сменить старый атрибут страничной организации памяти [MTRR на PAT](https://wiki.gentoo.org/wiki/MTRR_and_PAT).

Чтобы её включить, добавьте конфигурационный файл с параметром в `/etc/modprobe.d`:

```shell
su -
cat << _EOF_ > /etc/modprobe.d/nvidia_PAT.conf
# This options activate PAT
options nvidia NVreg_UsePageAttributeTable=1
_EOF_
make-initrd
```

::: warning

Удостоверьтесь, что ваша система поддерживает PAT, иначе у вас могут возникнуть проблемы с системой:

```shell
su -
cat /proc/cpuinfo | grep pat
```

:::

#### GSP прошивка

Некоторые видеокарты имеют [GPU System Processor (GSP)](https://download.nvidia.com/XFree86/Linux-x86_64/550.40.07/README/gsp.html), который может использоваться для разгрузки задач и управления графическим процессором. По умолчанию он включён для ограниченного числа видеокарт.

Начиная с архитектуры Turing, GSP присутствует во всех видеокартах и его можно принудительно включить:

```shell
su -
cat << _EOF_ > /etc/modprobe.d/nvidia_GSP_firmware.conf
# This options force unlock GPU firmware
options nvidia NVreg_EnableGpuFirmware=1
_EOF_
make-initrd
```

#### Фреймбуфер от NVIDIA

::: danger
Это экспериментальная функция и она работает нестабильно.
:::

Начиная с драйвера версии 545.29, можно включить фреймбуфер, предусмотренный `nvidia-drm`. Он заменяет стандартные фреймбуферы, такие как `efifb` или `vesafb`.

::: warning
Для работы необходимо, чтобы работал [KMS](#активация-kernel-mode-setting)
:::

```shell
su -
cat << _EOF_ > /etc/modprobe.d/nvidia-framebuffer.conf
# This options unlock experimental nvidia framebuffer
options nvidia_drm fbdev=1
_EOF_
```

### Решение известных проблем

#### «Неизвестный монитор» в настройках дисплеев в сессии Wayland

::: info
Данная проблема может привести к некорректному поведению устройств ввода. Особенно часто данные проблемы проявляются в играх.
:::

На данный момент существует 3 способа устранения фантомного неизвестного монитора:

##### Способ 1. Использование собственного фреймбуфера от NVIDIA:

Смотрите раздел [Фреймбуфер от NVIDIA](#фреимбуфер-от-nvidia)

##### Способ 2. Отключение загрузки simpledrm:

::: info
При использовании [epm](/epm) данный способ будет применён автоматически.
:::

- Внесите изменение в конфигурацию **GRUB**:

```shell
su -
mcedit /etc/sysconfig/grub2
```

- Добавьте в параметр `GRUB_CMDLINE_LINUX_DEFAULT` значение `initcall_blacklist=simpledrm_platform_driver_init`

- Сгенерируйте `grub.cfg`:

```shell
su -
grub-mkconfig -o /boot/grub/grub.cfg
```

::: warning

Данное решение приводит к невозможности входа в `tty`, отсутствию вывода логов во время загрузки (если не включён Plymouth) и чёрному экрану, если система по какой-то причине не запустилась вовсе.

Если после загрузки возник чёрный экран, необходимо проинспектировать запуск: уберите это значение из параметров ядра на этапе загрузки GRUB.

Также для решения проблем, может быть полезным удаление параметров `quiet` (для вывода более подробных логов) и `splash` (для отключения заставки во время вывода логов).

:::

##### Способ 3. Отключение монитора через настройки

Откройте настройки GNOME и во вкладке дисплеев отключите «Неизвестный монитор».

#### После настроек для сессии Wayland, он не появляется GDM

Если после настройки по каким-то причинам сессия с Wayland не появляется в выборе сессий GDM, его можно принудительно включить через [маскирование правил](https://git.altlinux.org/srpms/g/gdm.git?p=gdm.git;a=blob;f=gdm/data/61-gdm.rules.in;h=a4f841bdfe02138f2a4ef00979a8700caeeadcac;hb=45.0.1-alt3.1):

```
su -
ln -s /dev/null /etc/udev/rules.d/61-gdm.rules
```

::: info

Перед маскированием правил, удостоверьтесь в правильности настроек [сохранения выделенных ресурсов видеопамяти](#настроика-сохранение-выделенных-ресурсов-видеопамяти). Чаще всего проблемы именно из-за этого.

Также прочтите комментарии [правил GDM](https://git.altlinux.org/srpms/g/gdm.git?p=gdm.git;a=blob;f=gdm/data/61-gdm.rules.in;h=a4f841bdfe02138f2a4ef00979a8700caeeadcac;hb=45.0.1-alt3.1) и поищите правила, относящиеся к вашей системе.

Вполне возможно, есть объективная причина, почему режим Wayland недоступен.

:::

#### Не работает KMS

Если при загрузке GNOME возникает чёрный экран или при выполнении `cat /sys/module/nvidia_drm/parameters/modeset` возвращается `N`, можно попробовать [включить KMS через командную строку ядра](#активация-kernel-mode-setting).

#### Чёрный экран при выборе сессии X11 или ошибка в инициализации CUDA

Драйвер NVIDIA для Linux по умолчанию использует Message Signaled Interrupts (MSI), это обеспечивает лучшую совместимость и масштабируемость, из-за избегания совместного использования IRQ. Было замечено, что некоторые системы имели проблемы с поддержкой MSI.

Все известные ошибки были исправлены, но если наблюдаете данные проблемы, попробуйте отключить MSI:

```shell
su -
cat << _EOF_ > /etc/modprobe.d/nvidia_MSI.conf
# This options deactivate MSI
options nvidia NVreg_EnableMSI=0
_EOF_
make-initrd
```

#### Если при установке или первом запуске чёрный экран, артефакты или другие проблемы

Если при первом включении или установке появляются проблемы с отображением картинки, можно попробовать сменить режим вывода графики, чтобы в дальнейшем иметь возможность взаимодействовать с системой и выяснить причины проблем с видеодрайверами.

Для этого необходимо на этапе выбора вариантов загрузки в [GRUB](https://en.wikipedia.org/wiki/GNU_GRUB) нажмите кнопку [[e]], найдите первую строку с `linux /boot/vmlinuz` и допишите в эту строку один из следующих параметров (параметр должен быть отделён от других пробелом; очерёдность параметров не важна):

- `nomodeset` — не загружать видеодрайверы для видеокарты до момента, пока не будет загружен X-сервер. В результате система загружается в текстовом виде, можно видеть сообщения процесса загрузки, проблема «чёрного экрана загрузки» устраняется;
- `xdriver` — графический установщик предпринимает попытку автоматического подбора драйвера видеокарты, но иногда это ему не удаётся. Данным параметром можно отключить автоматический выбор и явно указать нужный вариант драйвера;
- `instdebug` — перед запуском и после завершения работы графического установщика будет запущена командная оболочка (shell). Это очень полезное средство для обнаружения ошибок графической программы установки. Последовательность работы внутренних сценариев следующая: `install2` -> `xinit` -> `alterator-install2` -> `alterator-wizard`. При необходимости можно вручную загрузить Xorg (команда `xinit`) и в открывшемся окне терминала запустить `alterator-install2` (или `alterator-wizard`) вручную. Лог-файлы инсталлятора сохраняются в `/tmp`.
- `xdriver` — отключает автоопределение и принудительно загружает указанный драйвер; можно указать любой драйвер, поддерживаемый Xorg. Например, `i915`, `nvidia`, `radeon`, `fglrx` и т.д.

  Существуют универсальные видеодрайверы:

  - `vesa` — минимальный драйвер. Работает так же, как и любой другой, но ожидает не конкретной видеокарты, а пытается следовать стандартам VESA (многие видеокарты его поддерживают). Этот драйвер умеет только выводить изображение, без «излишеств». Работает довольно медленно.
  - `fbdev` — ещё более простой драйвер. Передаёт команду связаться с ядром и пытается рисовать картинку через него. Под ним может быть несколько разных драйверов со стороны ядра, но чаще всего это ядерная версия `vesa`. Это работает ещё медленнее, но практически всегда работает.

::: info
Всё описание взято отсюда: [ALT Linux Wiki: Первая помощь - Проблемы с драйвером видеокарты](https://www.altlinux.org/Первая_помощь#Проблемы_с_драйвером_видеокарты)
:::

#### Прочие решения известных проблем

Также другие проблемы и возможные их решения, можно найти в [главе 8 документации NVIDIA](https://download.nvidia.com/XFree86/Linux-x86_64/550.40.07/README/commonproblems.html)

### Известные нерешённые проблемы

#### Системы, где есть NVIDIA со второй гибридной графикой и нет доступа к сессии Wayland:

На сегодняшний день есть проблемы с запуском Wayland на системах с гибридной графикой, поэтому [правила GDM](https://git.altlinux.org/srpms/g/gdm.git?p=gdm.git;a=blob;f=gdm/data/61-gdm.rules.in;h=a4f841bdfe02138f2a4ef00979a8700caeeadcac;hb=45.0.1-alt3.1#l85) запрещает работу Wayland в таких случаях.

Про проблему написано [тут](https://gitlab.gnome.org/GNOME/mutter/-/issues/1572#note_1308007) и [тут](https://gitlab.gnome.org/GNOME/mutter/-/merge_requests/3304#note_1983279).

::: warning
Правила GDM можно [замаскировать](#после-настроек-для-сессии-wayland-он-не-появляется-gdm), но в таком случае есть вероятность столкнуться с проблемами.
:::

#### Прочие известные нерешённые проблемы

В [главе 9 документации NVIDIA](https://download.nvidia.com/XFree86/Linux-x86_64/550.40.07/README/knownissues.html) можно ознакомиться с известными нерешёнными проблемами у драйвера NVIDIA

#### Проблемы c протоколом Wayland

У NVIDIA c Wayland существуют нерешённые проблемы. Вы можете ознакомиться с ними в [приложении L документации NVIDIA](https://download.nvidia.com/XFree86/Linux-x86_64/550.40.07/README/wayland-issues.html)

### Способы управления частотами/лимитами видеокарты

::: danger
Все цифры указаны для примера, все решения и риски лежат на вас.
:::

#### [nvidia-smi](#nvidia-system-management-interface)

Установить порога TDP:

```shell
su -
nvidia-smi -pl 160.30
```

Вывести в терминале поддерживаемые частоты:

```shell
su -
nvidia-smi -q -d SUPPORTED_CLOCKS
```

Установить пороги частоты GPU:

```shell
su -
nvidia-smi --lock-gpu-clocks=0,1695 --mode=1
```

Установить пороги частоты видеопамяти:

```shell
su -
nvidia-smi --lock-memory-clocks=0,5001
```

Для детальной настройки смотрите его [man-страницу](https://manpages.ubuntu.com/manpages/xenial/man1/alt-nvidia-340-smi.1.html)

::: tip
Описание примеров применения управления лимитами через nvidia-smi можно посмотреть [тут](https://wiki.archlinux.org/title/NVIDIA/Tips_and_tricks#Lowering_GPU_Boost_Clocks) и [тут](https://justin.palpant.us/monitor-and-maximize-nvidia-gpu-performance-on-linux/)
:::

::: warning
Изменение параметров не сохраняется при перезагрузке. Для сохранения параметров используйте `bashrc`, `udev` ([пример](https://nathanlabadie.com/proxmox-nvidia-and)) или `systemd` ([пример](https://wiki.archlinux.org/title/NVIDIA/Tips_and_tricks#Custom_TDP_Limit)).
:::

#### [Coolbits](https://en.wikipedia.org/wiki/Coolbits) (только для X11)

Для сессии X11 (через [X Config Options](https://us.download.nvidia.com/XFree86/Linux-x86_64/364.19/README/xconfigoptions.html)) существует возможность активировать не поддерживаемые функции NVIDIA через расширение [NV-CONTROL X](https://www.nvidia.com/en-us/drivers/IO-10753/). Активация функций происходит через указание битовой макси:

::: danger
Для работы необходима сессия под X11 и отключённый режим `nvidia_drm_modeset=0`, поэтому данная возможность является устаревшей.

Также для разных версий драйвера в документации заявлено разное количество функций. К примеру, в документации для версии 364.19 их описано 6, а в версии 550.54.14 их уже 2.
:::

| Бит  | Описание                                                                                                                                                                                                                                                                                                                                                                                                    |
| ---- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `1`  | Если установлено значение `1` (бит 1), позволяет разгонять старые ядра (до Fermi) на странице `Тактовые частоты` в разделе `Настройки NVIDIA`.                                                                                                                                                                                                                                                              |
| `2`  | Если установлено значение `2` (бит 1), драйвер NVIDIA попытается инициализировать SLI при использовании графических процессоров с разным объёмом видеопамяти.                                                                                                                                                                                                                                               |
| `4`  | Если установлено значение `4` (бит 2), на странице `Настройки термомонитора` будет доступна регулировка скорости вращения вентилятора графического процессора на графических платах с программируемыми возможностями вентилятора.                                                                                                                                                                           |
| `8`  | Если установлено значение `8` (бит 3), на странице `PowerMizer` в панели управления отобразится таблица, которая позволяет устанавливать смещение для каждого тактового домена и уровня производительности для применения к тактовым значениям. Это разрешено на некоторых графических процессорах GeForce. Не все тактовые диапазоны или уровни производительности могут быть изменены. (для Fermi и выше) |
| `16` | Если установлено значение `16` (бит 4), интерфейс командной строки `nvidia-settings` позволит настроить перенапряжение графического процессора. Это разрешено на некоторых графических процессорах GeForce. (для Fermi и выше)                                                                                                                                                                              |
| `0`  | Если установлено значение `0` (бит 0), все неподдерживаемые функции будут отключены.                                                                                                                                                                                                                                                                                                                        |

Установить битовую маску можно либо вручную в конфигурационном файле `xorg.conf` в разделе `Device`, либо через такие программы, как [nvidia-xconfig](#nvidia-xconfig) и [EnvyControl](#envycontrol)

::: details Пример работы с nvidia-xconfig:

```shell
nvidia-xconfig --cool-bits=2
```

:::

::: details Пример ручной записи в `xorg.conf`:

```shell
su -
cat << _EOF_ > /etc/X11/xorg.conf.d/22-cool_bits.conf
Section "Device"
	Identifier "NVIDIA GeForce"
	Driver     "nvidia"
	Option     "Coolbits" "24"
EndSection
_EOF_
```

:::

#### PowerMizer

PowerMizer — технология, созданная NVIDIA и предназначенная для экономии энергии.

::: warning
Начиная с драйвера версии 530.xx, данная технология была отключена и [рекомендуется](https://forums.developer.nvidia.com/t/kernel-module-option-nvreg-registrydwords-for-powermizerenable-doesnt-work-on-530-41-03/247610) использовать [nvidia-smi](#nvidia-system-management-interface). На старых драйверах данная технология работает в штатном режиме.
:::

::: info
Поскольку мир сталкивается с постоянно растущей потребностью в своих ресурсах, любая возможность устранить растрату энергии может помочь. Технология NVIDIA® PowerMizer® — это интеллектуальное решение для управления питанием, доступное на всех графических процессорах (GPU) NVIDIA, которое может эффективно продлить срок службы батареи и сократить потери энергии — и всё это при обеспечении производительности по требованию даже при подключении к сети.
:::

PowerMizer разрешает изменить политику работы энергосбережения видеокарты.

Изменение политики складывается из [включения/выключения технологии](#_1-включение-powermizer), [стратегии](#_2-стратегии) и [режима производительности](#_3-режимы-производительности) для каждого типа работы питания (от сети и от батареи).

##### 1. Включение PowerMizer

Включение/выключение технологии происходит через указание в параметре `PowerMizerEnable` значений `0x0` (выключен) и `0x1` (включён):

```
PowerMizerEnable=0x1
```

##### 2. Стратегии

Они позволяют выбирать логику подбора частот.

Существуют следующие стратегии:

| Стратегия | Описание                                                                                                                                                                                                                                    |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `22`      | Стратегия с фиксированной тактовой частотой — карта работает с фиксированной частотой вне зависимости от использования графического процессора                                                                                              |
| `33`      | Адаптивная стратегия тактовой частоты — карта работает на максимальном уровне энергосбережения, пока приложения не начинают интенсивно использовать ресурсы карты. Проверяет необходимость смены режима производительности каждые 15 секунд |

Указываются они для каждого типа работы питания следующим образом:

```shell
PerfLevelSrc=0x[стратегия для работы от батареи][стратегия для работы от сети]
```

```shell
PerfLevelSrc=0x2233
```

##### 3. Режимы производительности

Режимы производительности применяются только при стратегии с фиксированной частотой (`22`). Для адаптивной стратегии `33` указание режима не требуется.

Существует 3 режима производительности:

| Режим | Описание                                                                             |
| ----- | ------------------------------------------------------------------------------------ |
| `0x1` | Максимальная производительность — уровень с самым высоким уровнем производительности |
| `0x2` | Сбалансированный — один из средних уровней производительности                        |
| `0x3` | Максимальное энергосбережение — минимальный уровень производительности               |

Значения указываются в параметрах `PowerMizerDefault` и `PowerMizerDefaultAC`.

```shell
PowerMizerDefaultAC=0x3; PowerMizerDefault=0x1
```

| Параметр              | Описание                                                                                        |
| --------------------- | ----------------------------------------------------------------------------------------------- |
| `PowerMizerDefault`   | Содержит значение режима PowerMizer, которое будет использоваться для режима питания от батареи |
| `PowerMizerDefaultAC` | Содержит значение режима PowerMizer, которое будет использоваться для режима питания от сети    |

Если доступен только один тип работы питания (обычно от сети - AC, проверьте текущий параметр `GPUPowerSource`), используйте только тот параметр, который определяется в системе.

#### Есть 2 способа записи настроек

::: info
В примере использован вариант, когда для работы от сети и от батареи выбран режим с фиксированной частотой (`PerfLevelSrc=0x2222`); для питания от батареи выбрано максимальное энергосбережение (`PowerMizerDefaultAC=0x3`), а для питания от сети — максимальная производительность (`PowerMizerDefaultAC=0x3`)
:::

##### Способ 1. Запись в `/etc/modprobe.conf`:

```shell
su -
cat << _EOF_ > /etc/modprobe.d/nvidia_PowerMizer.conf
options nvidia NVreg_RegistryDwords="PowerMizerEnable=0x1;PerfLevelSrc=0x2222;PowerMizerDefault=0x1PowerMizerDefaultAC=0x3"
_EOF_
make-initrd
```

##### Способ 2. Запись в `/etc/X11/xorg.conf` (только для X11):

```shell
su -
cat << _EOF_ > /etc/X11/xorg.conf.d/21-PowerMizer.conf
Section "Device"
	Identifier "NVIDIA GeForce"
	Driver     "nvidia"
	Option     "RegistryDwords" "PowerMizerEnable=0x1;PerfLevelSrc=0x2222;PowerMizerDefault=0x1PowerMizerDefaultAC=0x3"
EndSection
_EOF_
```

::: tip
Для вступления настроек в силу необходима перезагрузка.
:::

[Данные об оборудовании и ПО](https://cloud.alt-gnome.ru/index.php/s/JSCj9gxB7j5boPg) пользователей за 2024 год.

## Открытый драйвер Nouveau

### Смена проприетарного драйвера от NVIDIA на Nouveau

- Перейдите в режим root:

```shell
su -
```

- Удалите `nvidia_glx_common`:

::: code-group

```shell[apt-get]
apt-get remove nvidia_glx_common
```

```shell[epm]
epm -e nvidia_glx_common
```

:::

- Удалите `initcall_blacklist` и `nvidia-drm.modeset`, если они есть:

```shell
mcedit /etc/sysconfig/grub2
```

- Сгенерируйте `grub.cfg`

```shell
grub-mkconfig -o /boot/grub/grub.cfg
```

- Удалите ссылку на `61-gdm.rules`, если она есть

```shell
rm /etc/udev/rules.d/61-gdm.rules
```

- Удалите правила, запрещающие Nouveau, если они есть:

```shell
rm /etc/modprobe.d/blacklist-nvidia-x11.conf
```

- Удалите изменение размещения видеопамяти, если оно есть:

```shell
rm /etc/modprobe.d/nvidia_videomemory_allocation.conf
```

- Установите драйвер (пример для ядра `6.12`):

::: code-group

```shell[apt-get]
apt-get install kernel-modules-drm-nouveau-6.12
```

```shell[epm]
epm -i kernel-modules-drm-nouveau-6.12
```

:::

- Если у Вас видеокарта **Curie** или старше, удостоверьтесь, что у вас установлен пакет `xorg-drv-nouveau` с DDX-драйвером Xf86-video-nouveau:

::: code-group

```shell[apt-get]
apt-get install xorg-drv-nouveau
```

```shell[epm]
epm -i xorg-drv-nouveau
```

:::

::: info

**Xf86-video-nouveau** — это [DDX-драйвер](https://dri.freedesktop.org/wiki/DDX/) для Xorg, необходимый для поддержки 2D и 3D-ускорения на старых видеокартах.

Для новых видеокарт существует универсальный [modesetting-драйвер](https://www.x.org/wiki/ModeSetting/) **Xf86-video-modesetting**, который уже входит в пакет Mesa и не нуждается в установке.

:::

- Перезагрузите систему

```shell
su -
reboot
```

Как только система загрузилась можно убедиться в том, что Nouveau заработало (в выводе сборки `initrd` должен присутствовать Nouveau):

```shell
su -
make-initrd
reboot
```

::: danger
Для видеокарт **Maxwell** потребуется обязательное [внедрение прошивки NVIDIA](#внедрение-прошивки-nvidia).
:::

### OpenGL и Zink

#### Zink по умолчанию

В настоящее время команда Mesa работает над OpenGL-драйвером Zink и в будущем рассчитывают сделать его стандартом для видеокарт **Turing и новее**. На момент лета 2024 года, в нём всё ещё активно устраняют ошибки, тем не менее, он уже сейчас [во многих случаях превосходит стандартный Nouveau OpenGL-драйвер](https://www.collabora.com/news-and-blog/news-and-events/nvk-is-now-ready-for-prime-time.html).

Стандартный Nouveau OpenGL-драйвер (NVC0) всё ещё актуальный и работает стабильно, но если хотите за счёт стабильности увеличить производительность, можете уже сейчас попробовать Zink и добавить `NOUVEAU_USE_ZINK=1` в переменные окружения.

Как один из вариантов, можно добавить строку `export NOUVEAU_USE_ZINK=1` в конец **~/.bashrc**:

```shell
mcedit ~/.bashrc
```

::: warning

Zink, как говорилось выше, нестабильный, и может ухудшить опыт работы с системой. Если наблюдаются вылеты приложений или иные проблемы, рекомендуется убрать параметр.

:::

#### Оптимизация ввода-вывода Zink

[Дополнительная оптимизация для Zink](https://www.phoronix.com/news/Mesa-24.1-Zink-ioopt-Merged), в некоторых случаях позволяющая улучшить отзывчивость. В частности, убирает лаг курсора мыши при использовании Zink.

На момент лета 2024 года она всё ещё не внедрена в систему по умолчанию, т.к. ждёт изменения CTS тестов, тем не менее её можно запустить, добавив в переменные окружения `ZINK_DEBUG=ioopt`.

Как один из вариантов, можно добавить строку `export ZINK_DEBUG=ioopt` в конец **~/.bashrc**:

```shell
mcedit ~/.bashrc
```

::: info

Параметр работает только в связке с [Zink](#оптимизация-ввода-вывода-zink).

:::

### Внедрение прошивки NVIDIA

Большинство видеочипов NVIDIA имеют встроенный аппаратный декодер, и некоторые видеочипы для его работы отдельно требуют извлечённую из драйвера прошивку NVIDIA. Прошивка NVIDIA требуется для видеокарт с аппаратным декодером: VP1, VP2, VP3, VP4.0, VP4.2, VP5 или VP6+. Список видеокарт с данными декодерами можно посмотреть на странице [Video Acceleration](https://nouveau.freedesktop.org/VideoAcceleration.html) в блоке `Which card has what engine`

::: info
Хоть вышеупомянутые аппаратные декодеры и требуют прошивку NVIDIA, не во всех реализована её поддержка. Статус поддержки для конкретного декодера смотрите на сайте [Video Acceleration](https://nouveau.freedesktop.org/VideoAcceleration.html) в блоке `Video engine support status`
:::

::: danger
Видеочипы **Maxwell** для их нормальной загрузки требуют **обязательное** внедрение прошивки. Если при первой установке или запуске системы на устройстве наблюдаются проблемы, можно временно перейти на [другой видеорежим](#если-при-установке-или-первом-запуске-черныи-экран-артефакты-или-другие-проблемы)
:::

- Установка прошивки:

::: code-group

```shell[apt-get]
apt-get install firmware-nouveau
```

```shell[epm]
epm -i firmware-nouveau
```

:::

::: details Ручная установка прошивки

- Распакуйте прошивку:

```shell
mkdir -p /tmp/nouveau && cd /tmp/nouveau
wget http://us.download.nvidia.com/XFree86/Linux-x86_64/340.108/NVIDIA-Linux-x86_64-340.108.run
wget https://raw.github.com/envytools/firmware/master/extract_firmware.py
sh NVIDIA-Linux-x86_64-340.108.run --extract-only
python3 extract_firmware.py
```

- Установите прошивку:

```shell
su -
cd /tmp/nouveau
mkdir /lib/firmware/nouveau
cp -d nv* vuc-* /lib/firmware/nouveau/
```

:::

### Управление питанием (Turing и новее)

Nouveau — драйвер с открытым исходным кодом для графических процессоров NVIDIA, развивается посредством реверс-инжиниринга. **До архитектуры Turing**, в управлении питанием возникали проблемы, о чём можно посмотреть на странице [Power Management](https://nouveau.freedesktop.org/PowerManagement.html).

Начиная с архитектуры Turing, видеокарты получили полную поддержку управления питанием благодаря GSP-прошивкам от NVIDIA. Видеокарты на базе архитектур Ampere и Ada Lovelace имеют эту поддержку по умолчанию. Для видеокарт на базе архитектуры Turing **необходимо указать специальный параметр ядра**.

Для того, чтобы на видеокартах **Turing** заработало управление питанием, можно прописать в параметр `GRUB_CMDLINE_LINUX_DEFAULT` значение `nouveau.config=NvGspRm=1` и сгенерировать новый `grub.cfg`, либо прописать в файле /etc/modprobe.conf.:

```shell
su -
cat << _EOF_ > /etc/modprobe.d/nouveau_power_management.conf
options nouveau config=NvGspRm=1
_EOF_
make-initrd
```

### Управление частотами через Reclocking (для GM10x Maxwell, Kepler и Tesla G94-GT218)

Видеочипы до архитектуры Turing не имеют поддержку управления питания на Nouveau, из-за чего остаются в режиме пониженного энергопотребления и пониженными частотами. Но на **Maxwell, код которых начинается с GM10x**, **Kepler** и **Tesla G94-GT218** есть возможность менять частоты GPU и видеопамяти через уже заготовленные пресеты частот GPU и видеопамяти.

- Проверьте доступные состояния питания:

```shell
su -
cat /sys/kernel/debug/dri/0/pstate
```

::: details Ожидаемый вид вывода

```shell
07: core 405 MHz memory 810 MHz
0f: core 653-954 MHz memory 1600 MHz
AC: core 953 MHz memory 1600 MHz
```

:::

- Проверьте интересующее состояние на работоспособность:

```shell
su -
echo pstate > /sys/kernel/debug/dri/0/pstate
```

Если всё работает стабильно и нет проблем, можно записать пресет в параметры ядра. Обратите внимание, что в выводе у нас было значение в шестнадцатеричном формате, для добавления в параметры ядра, значение необходимо перевести в десятеричный формат (для этого можно использовать любой конвертер из десятичной системы счисления в шестнадцатеричную).

В примере будет указано значение **0f**, которое перевели в десятеричный формат (**15**)

| Параметр                        | Описание                                                                                            |
| ------------------------------- | --------------------------------------------------------------------------------------------------- |
| `nouveau.config=NvClkMode=15`   | На этапе загрузки устанавливает необходимое состояние питания.                                      |
| `nouveau.config=NvClkModeAC=15` | На этапе загрузки устанавливает необходимое состояние питания, если устройство работает от сети.    |
| `nouveau.config=NvClkModeDC=15` | На этапе загрузки устанавливает необходимое состояние питания, если устройство работает от батареи. |

Можно прописать в параметр `GRUB_CMDLINE_LINUX_DEFAULT` и сгенерировать новый `grub.cfg`, либо прописать в файле /etc/modprobe.conf.

Пример записи в /etc/modprobe.conf:

```shell
su -
cat << _EOF_ > /etc/modprobe.d/nouveau_recloking.conf
options nouveau config=NvClkMode=15
options nouveau config=NvClkModeAC=15
options nouveau config=NvClkModeDC=15
_EOF_
make-initrd
```

::: danger
Хоть эта поддержка и существует давно, она имеет статус `MOSTLY` (всё основное сделано, но имеется ряд нерешённых проблем) и, скорее всего, останется таким навсегда.

Некоторые состояния могут перегреть устройство и навредить. Делая это, пожалуйста, следите за состоянием видеочипа.
:::

### Управление частотами через NVBoost (для Fermi, Kepler, Maxwell, Pascal и Volta):

Для **Fermi**, **Kepler**, **Maxwell**, **Pascal** и **Volta** существует способ управления частотами через 3 режима:

| Режим | Описание                                |
| ----- | --------------------------------------- |
| `0`   | Базовые тактовые частоты (по умолчанию) |
| `1`   | Тактовые частоты в режиме `Boost`       |
| `2`   | Максимальные тактовые частоты           |

Управление происходит через параметр `config.NvBoost`.

Например, установка тактовых частот в режиме boost будет `config.NvBoost=1`

Можно прописать это в параметр `GRUB_CMDLINE_LINUX_DEFAULT` и сгенерировать новый `grub.cfg`, либо прописать в файле /etc/modprobe.conf.

Пример записи в /etc/modprobe.conf:

```shell
su -
cat << _EOF_ > /etc/modprobe.d/nouveau_nvboost.conf
options nouveau config=NvBoost=1
_EOF_
make-initrd
```

### Управление скоростью вентиляторов (от Rankine до Maxwell)

Видеочипы **Rankine**, **Curie**, **Tesla**, **Fermi**, **Kepler** и **Maxwell** имеют поддержку управления вентиляторами.

Чтобы узнать точно, есть ли поддержка, нужно проверить, есть ли файлы управления:

```shell
ls /sys/class/drm/card0/device | grep pwm1
```

::: details Ожидаемый вид вывода

```shell
pwm1
pwm1_enable
pwm1_max
pwm1_min
```

:::

| Файл управления | Описание                                                                                    |
| --------------- | ------------------------------------------------------------------------------------------- |
| `pwm1`          | Управление постоянной скоростью.                                                            |
| `pwm1_enable`   | Включение режимов управления скоростью: `0` (выключить), `1` (вручную), `2` (автоматически) |
| `pwm1_max`      | Установка максимальной скорости.                                                            |
| `pwm1_min`      | Установка минимальной скорости.                                                             |

Путём добавления процентных значений скоростей в эти файлы (кроме `pwm1_enable`, где выбираются режимы), ими можно управлять

::: details Пример

- Включение ручного управление (если будет `0` или `2`, указывать скорости нет необходимости)

```shell
su -
echo 1 > /sys/class/drm/card0/device/pwm1_enable
```

- Установка мощности вентилятора на 40%

```shell
su -
echo 40 > /sys/class/drm/card0/device/pwm1
```

:::

Один из вариантов управления — сделать изменения постоянными. Для этого нужно занести их в `udev` правила.

- Пример ручного управления:

```shell
su -
cat << _EOF_ > /etc/udev/rules.d/50-nouveau-hwmon.rules
ACTION=="add", SUBSYSTEM=="hwmon", DRIVERS=="nouveau", ATTR{pwm1_enable}="1", ATTR{pwm1_enable}="40"
_EOF_
```

- Пример автоматического управления:

```shell
su -
cat << _EOF_ > /etc/udev/rules.d/50-nouveau-hwmon.rules
ACTION=="add", SUBSYSTEM=="hwmon", DRIVERS=="nouveau", ATTR{pwm1_enable}="2"
_EOF_
```

- Пример управления минимальными и максимальными значениями:

```shell
su -
cat << _EOF_ > /etc/udev/rules.d/50-nouveau-hwmon.rules
ACTION=="add", SUBSYSTEM=="hwmon", DRIVERS=="nouveau", ATTR{pwm1_enable}="1", ATTR{pwm1_min}="10", ATTR{pwm1_min}="90"
_EOF_
```

::: danger
При неправильном использовании есть шанс перегреть видеокарту. Соблюдайте осторожность
:::

### Список параметров Nouveau для ядра

Существует список параметров для ядра, про которые мало что можно написать или просто мало информации.

| Файл управления           | Описание                                                                                                                                                                                                                                          |
| ------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `runpm`                   | Принудительное включение (`1`) или отключение (`0`), управление питанием во время работы. По умолчанию только для систем Optimus установлено значение -`1`                                                                                        |
| `noaccel`                 | Отключение ускорение ядра / `abi16` (`1` — отключить ускорения, `0` — включить)                                                                                                                                                                   |
| `nofbaccel`               | Отключение ускорения `fbcon` (`1` — отключить ускорение, `0` — включить)                                                                                                                                                                          |
| `modeset`                 | Должен ли быть включён драйвер. `0` для отключённого, `1` для включённого, `2` для "безголового?"                                                                                                                                                 |
| `config.NvAGP`            | Режим `agp` (`0` для отключения, `1` для включения                                                                                                                                                                                                |
| `config.NvBios`           | Указать источник `VBIOS`, как один из OpenFirmware / PRAMIN / PROM / ACPI / PCIROM / PLATFORM или имя файла, переданное в `request_firmware`                                                                                                      |
| `config.NvFanPWM`         | Включить использование ШИМ для вентилятора, автоматическое определение по умолчанию                                                                                                                                                               |
| `config.NvForcePost`      | Нужно ли принудительно выполнять POST устройства, по умолчанию отключено                                                                                                                                                                          |
| `config.NvMemExec`        | Принудительное включение/отключение выполнения сценария синхронизации памяти.                                                                                                                                                                     |
| `config.NvGrUseFW`        | Использовать прерывания MSI, включённые по умолчанию на чипсетах, которые их поддерживают                                                                                                                                                         |
| `config.NvMXMDCB`         | Очистка выходов DCB из BIOS, включено по умолчанию                                                                                                                                                                                                |
| `config.NvPCIE`           | Только семейство NV40, использовать ли PCI-E GART, включено по умолчанию.                                                                                                                                                                         |
| `config.NvPmEnableGating` | Включает синхронизацию для графических процессоров Kepler                                                                                                                                                                                         |
| `vram_pushbuf`            | Создать push-буферы DMA во VRAM                                                                                                                                                                                                                   |
| `duallink`                | Разрешить двухканальную TMDS (включено по умолчанию)                                                                                                                                                                                              |
| `tv_norm`                 | Дефолтный ТВ норм. По умолчанию — PAL. Допустимые значения: `PAL`, `PAL-M`, `PAL-N`, `PAL-Nc`, `NTSC-M`, `NTSC-J`, `hd480i`, `hd480p`, `hd576i`, `hd576p`, `hd720p`, `hd1080i`. Это применимо только к картам, у которых нет внешних кодировщиков |
| `tv_disable`              | Отключить обнаружение ТВ-выхода                                                                                                                                                                                                                   |

## Источники:

https://www.altlinux.org/Nvidia

https://www.kernel.org/doc/html/latest/gpu/drm-kms.html

https://wiki.gentoo.org/wiki/NVIDIA/nvidia-drivers

https://en.wikipedia.org/wiki/Nouveau_(software)

https://www.altlinux.org/#Проблемы_с_драйвером_видеокарты

https://x.org/

https://nouveau.freedesktop.org/

https://bugzilla.altlinux.org/39108

https://packages.altlinux.org/ru/sisyphus/srpms/nvidia_glx_common/

https://download.nvidia.com/XFree86/Linux-x86_64/550.40.07/README/powermanagement.html

https://wiki.archlinux.org/title/NVIDIA

https://wiki.archlinux.org/title/NVIDIA/Tips_and_tricks

https://wiki.archlinux.org/title/Kernel_mode_setting

https://wiki.archlinux.org/title/Nouveau

https://wiki.gentoo.org/wiki/Nouveau

https://web.archive.org/web/20141031191559/https://kalgan.cc/blog/posts/Controlling_nVidia_cards_fans_with_nouveau_in_Debian/
