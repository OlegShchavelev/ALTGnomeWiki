# Flatpak

Flatpak — система для создания, распространения и запуска изолированных настольных приложений в Linux.

## Установка из репозитория

**Flatpak** можно установить через терминал:

::: code-group

```shell[apt-get]
su -
apt-get update
apt-get install flatpak
```

```shell[epm]
epm -i flatpak
```

:::

Выйдите из системы и снова войдите в неё, либо перезапустите систему, чтобы убедиться, что пути flatpak обновлены правильно.

::: details почему необходимо выйти из системы после установки Flatpak

```
Обратите внимание, что каталоги

'/var/lib/flatpak/exports/share'
'/home/oleg/.local/share/flatpak/exports/share'

не находятся по пути поиска, заданном переменной окружения XDG_DATA_DIRS,
поэтому приложения, установленные Flatpak, могут не отображаться на рабочем
столе, пока сеанс не будет перезапущен.
```

:::

## Альтернативный вариант установки Flatpak

Альтернативный и более удобным способом является установка пакета `flatpak-repo-flathub`, при установке пакета: автоматические пакет выполнит все вышеизложенные операции:

::: code-group

```shell[apt-get]
su -
apt-get update
apt-get install flatpak-repo-flathub
```

```shell[epm]
epm -i flatpak-repo-flathub
```

:::

:::info
В процессе установки пакета `flatpak-repo-flathub` произойдёт подключение репозитория `flathub`
:::

## Установка с помощью epm play

При установке через epm сразу установится flathub, а так же применится исправление для исправления ошибки: «enabling unprivileged user namespaces»

::: info
Актуально с версии **EPM 3.61.5**
:::

Для установки **Flatpak** с помощью EPM введите в терминале команду

```shell
epm play flatpak
```

## Использование Flatpak

Основные команды, необходимые для установки, запуска приложений Flatpak и управления ими. Для получения полного списка команд **Flatpak** выполните `flatpak --help`

### Управление репозиториями

Для просмотра репозиториев настроенных в вашей системе, выполните:

```shell
flatpak remotes
```

Добавить репозиторий, выполните:

```shell
flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
```

В данном случае, `flathub` указано локальное имя, которое присваивается удалённому устройству. URL указывает на файл удалённого устройства `.flatpakrepo` . Опция `--if-not-exists` останавливает команду от выдачи ошибки, если удалённое устройство уже существует.

:::info Наиболее популярные репозитории

Репозиторий GNOME Nightly:

```shell
flatpak remote-add --if-not-exists gnome-nightly https://nightly.gnome.org/gnome-nightly.flatpakrepo
```

Репозиторий Flatpak Beta:

```shell
flatpak remote-add flathub-beta https://flathub.org/beta-repo/flathub-beta.flatpakrepo
```

:::

Удалить репозиторий, выполните:

```shell
flatpak remote-delete flathub
```

В данном случае, `flathub` — локальное имя удалённого репозитория.

### Поиск приложений

Для поиска приложения/среды в Flatpak используйте команду `search`:

```shell
flatpak search krita
```

### Установка приложений

Для установки приложения, запустите:

```shell
flatpak install flathub org.gimp.GIMP
```

`flathub` — идентификатор удалённого репозитория, с которого должно быть установлено приложение, и `org.gimp.GIMP` - идентификатор приложения.

Как правило, приложению требуется определённая среда выполнения, и она будет установлена до приложения.

Сведения об устанавливаемом приложении также могут быть предоставлены в `.flatpakref` файле, который может быть удалённым или локальным. Чтобы указать `.flatpakref` вместо того, чтобы вручную указывать идентификатор удалённого устройства и приложения, запустите:

```shell
flatpak https://flathub.org/repo/appstream/org.gimp.GIMP.flatpakref
```

Начиная с Flatpak 1.2, команда `install` может выполнять предварительный поиск перед установкой приложения:

```shell
$ flatpak install gimp
```

Подтвердите удалённый доступ и команда приступит к установке нужного пакета.

В графическом режиме для установки приложений в Flatpak **используйте** [Центр приложений (GNOME Software)](/gnome-software). Во вкладке **«Установлено»** в списке выберите приложение и нажмите кнопку **«Установить»**.

![flatpak_2](/flatpak/flatpak_2.gif)

### Запуск приложений

Для запуска приложения в Flatpak используйте команду `run` и идентификатор приложения:

```shell
flatpak run org.gimp.GIMP
```

### Удаление приложений

Для удаления приложения в Flatpak используйте команду `uninstall` и идентификатор приложения:

```shell
flatpak uninstall org.gimp.GIMP
```

Для удаления сред выполнения и расширений, которые не используются установленными приложениями, используйте:

```shell
flatpak uninstall --unused
```

В графическом режиме для удаления приложений в Flatpak **используйте** [Центр приложений (GNOME Software)](/gnome-software). Во вкладке **«Установлено»** в списке выберите приложение и нажмите кнопку **«Удалить»**.

![flatpak_1](/flatpak/flatpak_1.gif)

### Устранение неполадок

Для исправления повреждённых пакетов Flatpak, используйте:

```shell
flatpak repair
```

Чтобы узнать, какие изменения вносились в вашу установку Flatpak с течением времени, вы можете просмотреть журналы:

```shell
flatpak history
```
