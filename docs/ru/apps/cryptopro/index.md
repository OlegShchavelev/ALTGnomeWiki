# КриптоПро

КриптоПро — разработанная одноимённой компанией линейка криптопровайдеров. Они используются в программах для генерации электронной подписи, работы с сертификатами, организации структуры PKI и т.д.

## Установка КриптоПРО

1. Загрузите архив ПО КриптоПро CSP 5.0 для Linux (x64, rpm) — ALT, РЕД ОС, ROSA с [официального сайта](https://www.cryptopro.ru/products/csp/downloads)

::: warning
**Предварительно требуется регистрация на сайте**
:::

![Раздел загрузки](/cryptopro/cryptopro-1.png)

2. Распакуйте архив (ПКМ -> `Извлечь`) и откройте папку `linux-amd64`

![Распаковка архива](/cryptopro/cryptopro-2.png)

3. Откройте эту папку в терминале: ПКМ -> `Открыть терминал`

![Контекстное меню для открытия терминала](/cryptopro/cryptopro-3.png)

4. Запустите установщик

```shell[apt-get]
sudo apt-get update
sudo ./install_gui.sh
```

5. Нажмите на кнопку `<Далее>`. Перемещаться между блоками можно с помощью кнопки [[Tab]], стрелочками внутри блоков на клавиатуре [[←]], [[→]], [[↑]], [[↓]], для подтверждения используйте [[Space]] или [[Enter]].

![Установщик](/cryptopro/cryptopro-4.png)

6. Выберите все пакеты для установки, кроме Провайдер КС2. Для выбора используйте [[Space]], для подтверждения [[Enter]] или `<Далее>`

![Выбор компонентов для установки](/cryptopro/cryptopro-5.png)

7. Начните установку, выбрав `<Установить>`

![Подтверждение списка установки](/cryptopro/cryptopro-6.png)

8. Дождитесь окончания установки и нажмите `<Ok>`

![Завершение установки](/cryptopro/cryptopro-7.png)

9. Если лицензия была приобретена отдельно, выберите `<Ввести лицензию>` и введите номер лицензии, указанную в бланке. Если лицензии нет или в сертификате есть встроенная лицензия — выберите `<Позже>`

![Лицензионный ключ](/cryptopro/cryptopro-8.png)

10. Выберите `<Выход>` и закройте установщик.

![Главное меню установщика](/cryptopro/cryptopro-9.png)

Источники:

- https://support.kontur.ru/ca/38813-ustanovka_kriptopro_csp_na_altlinux

## Вход с помощью токена на Госуслугах

1. Установите расширение для браузеров [на базе Chromium](https://chrome.google.com/webstore/detail/ifcplugin-extension/pbefkdcndngodfeigfdgiodgnmbgcfha) или для [Mozilla Firefox](https://ds-plugin.gosuslugi.ru/plugin/upload/assets/distrib/addon-1.2.8-fx.xpi)

2. Проверьте, что расширение включено: на сайте [Госуслуг](https://www.gosuslugi.ru/) расширение должно быть цветным и включённым. Если нет, проверьте настройки расширений

Для проверки работы: находясь на сайте Госуслуг, нажмите ПКМ на расширение, второй пункт сверху в меню должен быть — расширение может получать доступ к данным сайта и изменять их

![Расширение](/cryptopro/cryptopro-10.png)

3. Установите пакет IFCPlugin [с сайта Госуслуг](https://ds-plugin.gosuslugi.ru/plugin/upload/assets/distrib/IFCPlugin-x86_64.rpm) ([Источник: п.2 установки](https://support.cryptopro.ru/index.php?/Knowledgebase/Article/View/275))

4. Загрузите конфигурационный файл [`ifcx64.cfg`](https://www.cryptopro.ru/sites/default/files/public/faq/ifcx64.cfg) ([Источник: п.3 установки](https://support.cryptopro.ru/index.php?/Knowledgebase/Article/View/275))

5. Откройте терминал (ПКМ -> `Открыть терминал`) в той же папке, где находится файл `ifcx64.cfg`, и выполните команду

```shell
sudo cp ~/ifcx86.cfg /etc/ifc.cfg
```

6. Вход можно проверить на Госуслугах с помощью вашего токена на [странице входа](https://esia.gosuslugi.ru/login):

   - Нажмите на пункт `Войти с электронной подписью` и `Готово`
   - Выберите нужный сертификат электронной подписи
   - В окне `Ввод пин-кода`, введите любое значение (оно на данном этапе не проверяется) и нажмите `Продолжить`
   - При возникновении окна КриптоПро CSP, введите пин-код для ключевого контейнера в поле `Пароль` и нажать `OK`.

7. При возникновении проблем для браузеров на основе [Chromium](/chromium), выполните следующую команду:

```shell
sudo cp /etc/opt/chrome/native-messaging-hosts/ru.rtlabs.ifcplugin.json /etc/chromium/native-messaging-hosts
```

### Решение проблем

Ошибка `Электронная подпись не найдена` означает, что есть проблемы с файлом `ifcx64.cfg`. Повторите действие из Пункта 4

![Ошибка на портале Госуслуги](/cryptopro/cryptopro-11.jpg)

Источники:

- [Сайт КриптоПро](https://support.cryptopro.ru/index.php?/Knowledgebase/Article/View/275)
- [Госуслуги](https://ds-plugin.gosuslugi.ru/plugin/upload/Index.spr)
