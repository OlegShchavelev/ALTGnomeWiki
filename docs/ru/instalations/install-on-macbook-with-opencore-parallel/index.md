# Установка ALT Regular Gnome на Mac [OpenCore Bootloader, Swap через файл]

Данное руководство написано с целью рассказать о возможности установки ALT Regular Gnome
параллельно с установленной операционной системой macOS.

::: warning
В руководстве используется OpenCore загрузчик из пакета [OpenCore Legacy Patcher](https://dortania.github.io/OpenCore-Legacy-Patcher/)
:::

## Подготовка

1. В `Balena Etcher` или с помощью `dd` делаем загрузочную флешку с ALT Regular Gnome

   :::warning
   Убедитесь, что флешка отформатирована верно и имеет схему разделов «Схема разделов GUID». Это необходимое условие для загрузки в UEFI Mac
   :::

   ```shell
       # что-бы глянуть какие внешние диски подключены
       diskutil list | grep -A2 "(external, physical)"

       # запсиываем образ на флешку
       # /dev/disk4 - это диск определенный на предыдущем этапе
       sudo dd if=regular-gnome-latest-x86_64.iso of=/dev/disk4 bs=1m
   ```

2. В `DiskUtility` выделяем раздел для установки (форматируя его в FAT32, чтобы проще было найти)
3. Перезагружаем Mac, с зажатой клавишей `Option` и выбираем `EFI Boot` с иконкой OpenCore
4. Появится список дисков с которого надо грузится, там выбираем `El Torito`
5. Выбираем `Install ALT regular-gnome/x86_64`

## Установка

1. В разделе разметки диска выбираем `Вручную`
2. На следующем экране ищем раздел размером более 200МБ отформатированный в FAT32 (~sda3), это и будет наш раздел.

- Нажимаем `Удалить файловую систему`
- Нажимаем `Создать файловую систему` и выбираем `ext4` (пойдём простым путём)
- На шаге `Изменить точку монтирования` убедимся, что стоит `/` и нажимаем `ОК`

3. Далее переходим на раздел размером 200МБ (sda1), это раздел EFI с файловой системой FAT32) и нажимаем кнопку `Изменить точку монтирования`

- Система сама предложит нам точку монтирования `/boot/efi`

::: warning
Убеждаемся, что квадрат поля `Отформатировать` пуст! (галки нет) !!!
:::

4. Продолжаем обычную установку (swap добавим позже)
5. Загрузчик устанавливается как обычно (ничего менять не надо)

## Настройка после установки

### SWAP файлом

Чтобы не создавать кучу разделов в системе, мы отказались от раздела под SWAP.
Теперь, если нам необходимо сделать SWAP в системе, мы можем прибегнуть к следующим шагам:

#### Для файловой системы EXT4

```shell
su -

# создаст swap размером с оперативную память
dd if=/dev/zero of=/swapfile bs=1M count=`free -m | awk 'NR==2 {print $2}'`
# или указать самостоятельно, например размер в 4 гигабайта
dd if=/dev/zero of=/swapfile bs=1M count=4096

chmod 600 /swapfile
mkswap /swapfile

echo "/swapfile none swap defaults 0 0" >> /etc/fstab # важно >>
cat /etc/fstab # смотрим что строка с /swapfile появилась в конце файла

reboot
```

#### Для файловой системы BTRFS

Хоть установка в мануале и описана на EXT4, ничто не мешает сделать её и с использованием файловой системы BTRFS. В связи с чем ниже про SWAP файлом на BTRFS

:::warning
Только в случае если BTRFS включает только тома на одном устройстве
:::

```shell
su -
btrfs subvolume create /swap

# создаем SWAP файл размером 4 гигабайта (пример)
btrfs filesystem mkswapfile --size 4g --uuid clear /swap/swapfile

swapon /swap/swapfile

echo "/swapfile none swap defaults 0 0" >> /etc/fstab # важно >>
cat /etc/fstab # смотрим что строка с /swapfile появилась в конце файла

reboot
```

TODO: - Про настройку отображения значка системы Альт в OpenCore bootloader-e
TODO: - Наглядные материалы
